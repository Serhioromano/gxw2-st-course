# Таймеры

## Стандарт МЭК-61131-3

Таймеры в FX3G\FX3U можно запускать стандартными Функциональными Блоками `TON`, `TOF`, `TP`.

!!! warning "**Ограничения**"

    Количество Функциональных Блоков которые вы можете создать в программе ограничено, так как под капотом, GX Works 2 использует таймеры области `T` для создания Функциональных Блоков `TON`, `TOF`, `TP`.

    А использует он те таймеры, которые вы выделите в этом окне *Меню / Tools / Device\Label Automatic-Assign Settings...*
    ![Назначение таймеров](../img/timerassign.png)

### TON

Давайте объявим экземпляр блока TON.

![Объявление переменной](../img/tondeclaration.png)

Вставим шаблон функции в программу.

```iecst
fbTON1(IN:=M0,PT:=T#10s,Q:=M1,ET:=tET);
```

Эта небольшая программка, если контакт М0 замкнется, контакт М1 замкнется через 10 секунд. D0 будет показывать сколько время осталось до истечения. Давайте просуммируем.

![Симуляция TON](../img/tonsimul.png)

### TOF

### TP

### Задание

Напишите 3 Функциональных Блока `BLINK1`б `BLINK2` и `BLINK3` все делающие одно и тоже что и стандартный блок `BLINK` но каждый с применением разного таймера `TON`, `TOF`, `TP`.

**Входные переменные**

- `IN` - Начало работы
- `TIMELOW` - Время не работы в формате Time.
- `TIMEHI` - Время работы в формате Time.

**Выходные переменные**

- `Q` - Сигнал во время работы.
- `CNT` - Сколько раз моргнул.

## Область **T**

Кроме стандартных Функциональных Блоков таймеров `TON`, `TOF`, `TP` которые мы рассмотрим позже, в GX Works 2 есть свои таймеры, которые имеют свою область памяти и свои блоки. И если привыкнуть, то работа с такими таймерами достаточно удобная.

| Назначение                      | Диапазон      | Кол. |
| ------------------------------- | ------------- | ---- |
| Шаг 100ms                       | `T0`~`T199`   | 200  |
| Шаг 10ms                        | `T200`~`T245` | 46   |
| Шаг 1ms аккумулятивный EEPROM   | `T246`~`T249` | 4    |
| Шаг 100ms аккумулятивный EEPROM | `T250`~`T255` | 6    |
| Шаг 1ms                         | `T256`~`T319` | 64   |

Каждый блок здесь является группой реле и регистров. Обращаться напрямую к блоку `T0` вы ни когда не будете по крайней мере в ST.

Например `T0` это:

- `TC0` - (Timer Coil) катушка таймера используется для включения таймера.
- `TS0` - (Timer State) контакт таймера, замыкается когда таймер завершает работу.
- `TN0` - (Timer Number) время работы таймера, или сколько таймер уже отработал от начала работы в шагах.

Для работы с таймерам используется инструкция `OUT_T`.

```iecst
OUT_T(X0, TC0, 10);
Y0 := TS0;
```

Инструкция `OUT_T` принимает 3 параметра.

1. Первый это контакт который указывает условие начала работы таймера. Здесь можно вставить и выражение.
2. Второй параметр, это номер катушки таймера. С каким именно таймером мы будем работать.
3. Третий параметр это время работы таймера. Время работы указывается в шагах. Так как мы использовали таймер `T0`, в таблице видим что его шаг 100ms. Это значит что каждая 1 в этом параметре равно 100мс. Другими словами наше 10 это 1000мс или 1с.

Разберем пример, что там происходит. Когда контакт X0 замкнется, или другими словами на вход номер 1 ПЛК поступит сигнал, таймер начнет работу. Работать он будет как мы выяснили 1 секунду, и через секунду активирует катушку `Y0`, так как `TS0` замкнется по окончании работы таймера.

Давайте напишем таймеры `TON`, `TOF`, `TP` .

Создадим новый Функциональный Блок и назовем его `CTP` от сокращения (Custom TP).

Давайте напишем одну бесполезную программу но которая очень хорошо продемонстрирует работу таймера. Это будет просто таймер на выполнение

```iecst
OUT_T(M100, TC0, 10);
Y0 := TS0;
```

### Задание

Создайте Функциональный Блок таймеров `TON`, `TOF`, `TP`,  с использованием инструкции `OUT_T`. Назовите их `CTON` сокращения (Custom TON),  `CTOF` (Custom TOF) и `CTP` (Custom TP). У всех Функциональных Блоков будет один и тот же набор входных и выходных переменных.

Входные переменные

- `IN` - Начало работы
- `PT` - Время работы в формате Time.

Выходные переменные

- `Q` - Окончание работы
- `ET` - Сколько осталось до конца работы в формате Time.

Так же создайте Функциональный Блок `CBLINK` (Custom BLINK)

Входные переменные

- `IN` - Начало работы
- `TIMELOW` - Время не работы в формате Time.
- `TIMEHI` - Время работы в формате Time.

Выходные переменные

- `Q` - Сигнал во время работы.

Конечно в программе можно будет создать только один экземпляр такого Функционального Блока. Так как если экземпляров будет больше одного, то они оба будут ссылаться на один и тот же внутренний таймер и будет конфликт наложения данных. Другими словами эти Функциональные Блоки совершенно не применимы в реальной программе, но на их примере вы сможете понять как применять инструкцию `OUT_T` во всех 3х сценариях.
